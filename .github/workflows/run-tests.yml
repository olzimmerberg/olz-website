on: push
name: Run tests
jobs:
  run-php-tests:
    strategy:
      matrix:
        php-version: ['7.2', '7.4']
    name: PHP tests (PHP ${{ matrix.php-version }})
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2
    - uses: shivammathur/setup-php@v1
      with:
        php-version: ${{ matrix.php-version }}
    - name: Get composer cache
      id: composer-cache
      run: echo "::set-output name=dir::$(composer config cache-files-dir)"
    - name: Cache dependencies
      uses: actions/cache@v1
      with:
        path: ${{ steps.composer-cache.outputs.dir }}
        key: ${{ runner.os }}-composer-${{ hashFiles('**/composer.lock') }}
        restore-keys: ${{ runner.os }}-composer-
    - name: Install dependencies
      run: composer install --prefer-dist
    - name: Lint PHP
      run: cd ./tests; ./php-lint.sh
    - name: Indented with spaces
      run: cd ./tests; ./php-indent-spaces.sh
    - name: Code style check
      run: cd ./tests; ./php-code-style.sh
