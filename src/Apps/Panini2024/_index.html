<html>
<head>
<meta name='robots' content='noindex, nofollow' />
<style type='text/css'>


@font-face {
    font-family: 'Open Sans';
    font-style: normal;
    font-weight: 400;
    src: local('Open Sans'), local('OpenSans'), url('/assets/icns/fonts/OpenSans400.woff') format('woff'), url('/assets/icns/fonts/OpenSans400.svg#OpenSans') format('svg');
}
@font-face {
    font-family: 'Open Sans';
    font-style: normal;
    font-weight: 700;
    src: local('Open Sans Bold'), local('OpenSans-Bold'), url('/assets/icns/fonts/OpenSans700.woff') format('woff'), url('/assets/icns/fonts/OpenSans700.svg#OpenSans-Bold') format('svg');
}

html, body {
    height:100%;
    font-size:12pt;
}

a {
    color:rgb(0,150,0);
    text-decoration:none;
}

div {
    margin:0cm;
    padding:0cm;
}

@media print {
    .control {
        display:none;
    }
    
    #output {
        min-height:0cm;
    }
}
</style>
<script src='paniniData.js' type='text/javascript'></script>
<script>

window.borderColor = "rgba(255,255,255,0.5)";
window.borderWid = 0.05;// 0.05
window.cuttingWid = 0.05;
window.cardsPerRow = 4;
window.cardsPerCol = 4;
window.cardWid = 4.55;
window.cardHei = 6.55;
window.paperWid = 20.9;
window.paperHei = 29.55;
window.pxPerCm = 200;
window.cardIDs = [];
window.cardHTML = "";

window.dMinHeiLand = 0.6;
window.dMaxHeiLand = 0.8;
window.dMinHeiPort = 1.0;
window.dMaxHeiPort = 1.2;


function special(isLandscape, hasTop, name, imgsrc, imgstyle, ort, callback) {
    if (!ort) ort = false;
    var mX = 0;
    var mY = 0;
    var mWid = 1;
    var mHei = 1;

    var cnv = document.createElement("canvas");
    var wid = window.cardWid-2*window.borderWid;
    var hei = window.cardHei-2*window.borderWid;
    var cwid = 0;
    var chei = 0;
    if (isLandscape) {
        cnv.setAttribute("style", "width:"+(hei*mWid)+"cm; height:"+(wid*mHei)+"cm; ");
        cwid = Math.round(window.pxPerCm*hei*mWid);
        chei = Math.round(window.pxPerCm*wid*mHei);
        cnv.setAttribute("width", cwid);
        cnv.setAttribute("height", chei);
    } else {
        cnv.setAttribute("style", "width:"+(wid*mWid)+"cm; height:"+(hei*mHei)+"cm; ");
        cwid = Math.round(window.pxPerCm*wid*mWid);
        chei = Math.round(window.pxPerCm*hei*mHei);
        cnv.setAttribute("width", cwid);
        cnv.setAttribute("height", chei);
    }
    
    // Image
    window.imageLoaded = false;
    window.imageOrtLoaded = false;
    var imagesLoaded = function () {
        if (!window.imageLoaded || !window.imageOrtLoaded) return;
        var ctx = cnv.getContext('2d');
        var matches = /width\:([0-9\.]+)(cm|\%)/.exec(imgstyle);
        var imgwid = cwid;
        if (matches && matches[1]) {
            if (matches[2]=="cm") imgwid = window.pxPerCm*matches[1];
            else if (matches[2]=="%") imgwid = cwid*matches[1]/100;
        }
        var imghei = imgwid*imageObj.height/imageObj.width;
        
        var matches = /left\:(\-?[0-9\.]+)(cm|\%)/.exec(imgstyle);
        var imgleft = 0;
        if (matches && matches[1]) {
            if (matches[2]=="cm") imgleft = window.pxPerCm*matches[1];
            else if (matches[2]=="%") imgleft = cwid*matches[1]/100;
        }
        
        var matches = /top\:(\-?[0-9\.]+)(cm|\%)/.exec(imgstyle);
        var imgtop = 0;
        if (matches && matches[1]) {
            if (matches[2]=="cm") imgtop = window.pxPerCm*matches[1];
            else if (matches[2]=="%") imgtop = chei*matches[1]/100;
        }
        
        ctx.drawImage(imageObj, imgleft, imgtop, imgwid, imghei);
    
        
        // Topbox
        if (hasTop) {
            var grd = ctx.createLinearGradient(0, 0, 0, (isLandscape?window.dMaxHeiLand:window.dMaxHeiPort)*window.pxPerCm);
            grd.addColorStop(0, "rgb(0,150,0)");
            grd.addColorStop(1, "rgb(0,120,0)");
            ctx.beginPath();
            ctx.moveTo(0, 0);
            ctx.lineTo(cwid, 0);
            ctx.lineTo(cwid, (isLandscape?window.dMinHeiLand:window.dMinHeiPort)*window.pxPerCm);
            ctx.lineTo(0, (isLandscape?window.dMaxHeiLand:window.dMaxHeiPort)*window.pxPerCm);
            ctx.fillStyle = grd;
            ctx.fill();
            // Yellow Bar
            ctx.beginPath();
            ctx.moveTo(0, (isLandscape?window.dMaxHeiLand-0.1:window.dMaxHeiPort-0.15)*window.pxPerCm);
            ctx.lineTo(cwid, (isLandscape?window.dMinHeiLand-0.1:window.dMinHeiPort-0.15)*window.pxPerCm);
            ctx.lineTo(cwid, (isLandscape?window.dMinHeiLand:window.dMinHeiPort)*window.pxPerCm);
            ctx.lineTo(0, (isLandscape?window.dMaxHeiLand:window.dMaxHeiPort)*window.pxPerCm);
            ctx.fillStyle = "rgb(255,255,0)";
            ctx.shadowColor = "rgba(0,0,0,0)";
            ctx.fill();
            // Black Bar
            ctx.beginPath();
            ctx.moveTo(0, (isLandscape?window.dMaxHeiLand:window.dMaxHeiPort)*window.pxPerCm);
            ctx.lineTo(cwid, (isLandscape?window.dMinHeiLand:window.dMinHeiPort)*window.pxPerCm);
            ctx.lineTo(cwid, (isLandscape?window.dMinHeiLand+0.1:window.dMinHeiPort+0.15)*window.pxPerCm);
            ctx.lineTo(0, (isLandscape?window.dMaxHeiLand+0.1:window.dMaxHeiPort+0.15)*window.pxPerCm);
            ctx.fillStyle = "rgb(0,0,0)";
            ctx.shadowBlur = (isLandscape?0.1:0.15)/2*window.pxPerCm;
            ctx.shadowColor = "rgba(0,0,0,0.5)";
            ctx.shadowOffsetX = 0;
            ctx.shadowOffsetY = (isLandscape?0.1:0.15)/4*window.pxPerCm;
            ctx.fill();
        } else if (ort) {
            ctx.shadowBlur = 0.15*window.pxPerCm;
            ctx.shadowColor = "rgba(0,0,0,1)";
            ctx.shadowOffsetX = 0;
            ctx.shadowOffsetY = 0;
            ctx.drawImage(imageObjOrt, cwid-0.9*window.pxPerCm, 0.1*window.pxPerCm, 0.8*window.pxPerCm, 0.8*window.pxPerCm);
            ctx.shadowColor = "rgba(0,0,0,0)";
        }
    
        // Namebox
        var grd = ctx.createLinearGradient(0, chei-(isLandscape?window.dMaxHeiLand:window.dMaxHeiPort)*window.pxPerCm, 0, chei);
        grd.addColorStop(0, "rgb(0,150,0)");
        grd.addColorStop(1, "rgb(0,120,0)");
        ctx.beginPath();
        ctx.moveTo(0, chei);
        ctx.lineTo(cwid, chei);
        ctx.lineTo(cwid, chei-(isLandscape?window.dMaxHeiLand:window.dMaxHeiPort)*window.pxPerCm);
        ctx.lineTo(0, chei-(isLandscape?window.dMinHeiLand:window.dMinHeiPort)*window.pxPerCm);
        ctx.fillStyle = grd;
        ctx.fill();
        // Yellow Bar
        ctx.beginPath();
        ctx.moveTo(0, chei-(isLandscape?window.dMinHeiLand:window.dMinHeiPort)*window.pxPerCm);
        ctx.lineTo(cwid, chei-(isLandscape?window.dMaxHeiLand:window.dMaxHeiPort)*window.pxPerCm);
        ctx.lineTo(cwid, chei-(isLandscape?window.dMaxHeiLand+0.1:window.dMaxHeiPort+0.15)*window.pxPerCm);
        ctx.lineTo(0, chei-(isLandscape?window.dMinHeiLand+0.1:window.dMinHeiPort+0.15)*window.pxPerCm);
        ctx.fillStyle = "rgb(255,255,0)";
        ctx.shadowBlur = (isLandscape?0.1:0.15)/2*window.pxPerCm;
        ctx.shadowColor = "rgba(0,0,0,0.5)";
        ctx.shadowOffsetX = 0;
        ctx.shadowOffsetY = -(isLandscape?0.1:0.15)/4*window.pxPerCm;
        ctx.fill();
        // Black Bar
        ctx.beginPath();
        ctx.moveTo(0, chei-(isLandscape?window.dMinHeiLand-0.1:window.dMinHeiPort-0.15)*window.pxPerCm);
        ctx.lineTo(cwid, chei-(isLandscape?window.dMaxHeiLand-0.1:window.dMaxHeiPort-0.15)*window.pxPerCm);
        ctx.lineTo(cwid, chei-(isLandscape?window.dMaxHeiLand:window.dMaxHeiPort)*window.pxPerCm);
        ctx.lineTo(0, chei-(isLandscape?window.dMinHeiLand:window.dMinHeiPort)*window.pxPerCm);
        ctx.fillStyle = "rgb(0,0,0)";
        ctx.shadowColor = "rgba(0,0,0,0)";
        ctx.fill();
        // Text
        var arr = name.split("\n");
        ctx.font = Math.round(0.35*window.pxPerCm)+"px Open Sans";
        ctx.fillStyle = "rgb(255,255,0)";
        ctx.textAlign = (ort?"right":"center");
        for (var i=0; i<arr.length; i++) {
            ctx.fillText(arr[i], (ort?cwid-0.15*window.pxPerCm:cwid/2), chei-((isLandscape?0.15:0.35)-(arr.length-1)*0.45/2+(arr.length-i-1)*0.45)*window.pxPerCm); 
        }
        callback(cnv);
    };
    var imageObj = new Image();
    imageObj.onload = function () {
        window.imageLoaded = true;
        imagesLoaded();
    };
    imageObj.src = imgsrc;
    if (ort) {
        var imageObjOrt = new Image();
        imageObjOrt.onload = function () {
            window.imageOrtLoaded = true;
            imagesLoaded();
        };
        imageObjOrt.src = ort;
    } else {
        window.imageOrtLoaded = true;
    }
};

window.redrawTimer = false;
window.redrawing = false;
function redraw() {
    var loadingElem = document.getElementById('loading');
    var downloadLinkElem = document.getElementById("download-link");
    loadingElem.style.display = "block";
    downloadLinkElem.style.visibility = "hidden";
    if (window.redrawTimer) window.clearTimeout(window.redrawTimer);
    window.redrawTimer = window.setTimeout(doRedraw, 100);
}
function doRedraw() {
    if (window.redrawing) {
        return redraw();
    }
    window.redrawing = true;
    var getImage = function () {
        var imageElem = document.getElementById("image");
        var template = parseInt(imageElem.getAttribute('template'));
        if (0<=template) {
            getText('panini_data/'+window.cards[template]['imgsrc']);
        } else if (0<imageElem.files.length) {
            var reader = new FileReader();
            reader.onload = function () {
                var dataURL = reader.result;
                getText(dataURL);
            };
            reader.readAsDataURL(imageElem.files[0]);
        } else {
            getText("default.jpg");
        }
    };
    var getText = function (imageVal) {
        var textElem = document.getElementById("text");
        var textVal = textElem.value;
        getOrt(imageVal, textVal);
    }
    var getOrt = function (imageVal, textVal) {
        var ortSelectElem = document.getElementById("ort-select");
        var ortImageElem = document.getElementById("ort-image");
        if (ortSelectElem.value=='custom') {
            var template = parseInt(ortImageElem.getAttribute('template'));
            if (0<=template) {
                getOptions(imageVal, textVal, "panini_data/wappen/"+window.cards[template]['ort']+".jpg");
            } else if (0<ortImageElem.files.length) {
                var reader = new FileReader();
                reader.onload = function () {
                    var dataURL = reader.result;
                    getOptions(imageVal, textVal, dataURL);
                };
                reader.readAsDataURL(ortImageElem.files[0]);
            } else {
                getOptions(imageVal, textVal, false);
            }
        } else if (ortSelectElem.value=='') {
            getOptions(imageVal, textVal, false);
        } else {
            getOptions(imageVal, textVal, "panini_data/wappen/"+ortSelectElem.value+".jpg");
        }
    }
    var getOptions = function (imageVal, textVal, ortVal) {
        var landscapeElem = document.getElementById("landscape");
        var landscapeVal = landscapeElem.checked;
        var hasTopElem = document.getElementById("has-top");
        var hasTopVal = hasTopElem.checked;
        var imageWidthElem = document.getElementById("image-width");
        var imageTopElem = document.getElementById("image-top");
        var imageLeftElem = document.getElementById("image-left");
        var imageWidthVal = imageWidthElem.value;
        var imageTopVal = imageTopElem.value;
        var imageLeftVal = imageLeftElem.value;
        finish(imageVal, textVal, ortVal, landscapeVal, hasTopVal, imageWidthVal, imageTopVal, imageLeftVal);
    }
    var finish = function (imageVal, textVal, ortVal, landscapeVal, hasTopVal, imageWidthVal, imageTopVal, imageLeftVa) {
        special(landscapeVal, hasTopVal, textVal, imageVal, "width:"+imageWidthVal+"%; top:"+imageTopVal+"%; left:"+imageLeftVa+"%;", ortVal, function (cnv) {
            var outputElem = document.getElementById("output");
            var outputImgElem = document.getElementById("output-img");
            var dataURL = cnv.toDataURL();
            var downloadLinkElem = document.getElementById("download-link");
            var res = /^data:image\/([^;]+);/.exec(dataURL);
            downloadLinkElem.download = "panini."+res[1];
            downloadLinkElem.href = dataURL.replace(/^data:image\/[^;]+;/, 'data:application/octet-stream;');
            downloadLinkElem.onclick = function (dataURL, e) {
                window.setTimeout(function (dataURL) {
                    window.location.href = dataURL;
                }.bind(this, dataURL), 500)
            }.bind(this, dataURL);
            downloadLinkElem.style.visibility = "visible";
            outputElem.style.backgroundImage = "url("+dataURL+")";
            outputImgElem.src = dataURL;
            window.redrawing = false;
            document.getElementById('loading').style.display = "none";
        });
    };
    window.setTimeout(getImage, 1);
}

window.onload = function () {
    var templateElem = document.getElementById("template");
    var imageElem = document.getElementById("image");
    var textElem = document.getElementById("text");
    var ortSelectElem = document.getElementById("ort-select");
    var ortImageElem = document.getElementById("ort-image");
    var landscapeElem = document.getElementById("landscape");
    var hasTopElem = document.getElementById("has-top");
    var imageWidthElem = document.getElementById("image-width");
    var imageTopElem = document.getElementById("image-top");
    var imageLeftElem = document.getElementById("image-left");
    var imageQuality1 = document.getElementById("image-quality-1");
    var imageQuality2 = document.getElementById("image-quality-2");
    var htmlout = "<select><option value='-1'>Eigenes Panini machen...</option>";
    for (var i=0; i<window.cards.length; i++) {
        htmlout += "<option value='"+i+"'>"+window.cards[i]['name']+"</option>";
    }
    htmlout += "</select>";
    templateElem.innerHTML = htmlout;
    templateElem.firstChild.onchange = function () {
        if (this.value==-1) {
            return;
        }
        var card = window.cards[this.value];
        landscapeElem.checked = card['isLandscape'];
        hasTopElem.checked = card['hasTop'];
        textElem.value = card['name'];
        textElem.value = card['name'];
        imageElem.setAttribute('template', this.value);
        var imgstyle = card['imgstyle'];
        imageWidthElem.value = /width\:([^\%]+)\%\;/.exec(imgstyle)[1];
        imageTopElem.value = /top\:([^\%]+)\%\;/.exec(imgstyle)[1];
        imageLeftElem.value = /left\:([^\%]+)\%\;/.exec(imgstyle)[1];
        textElem.value = card['name'];
        ortSelectElem.value = card['ort']?'custom':'';
        ortImageElem.setAttribute('template', this.value);
        redraw();
    }.bind(templateElem.firstChild);
    var setCustomAndRedraw = function () {
        templateElem.firstChild.value = -1;
        redraw();
    }
    imageElem.onchange = function () {
        imageElem.setAttribute('template', -1);
        setCustomAndRedraw();
    };
    textElem.onchange = setCustomAndRedraw;
    textElem.onkeyup = setCustomAndRedraw;
    ortSelectElem.onchange = function () {
        ortImageElem.style.display = (ortSelectElem.value=='custom'?'block':'none');
        setCustomAndRedraw();
    };
    ortImageElem.onchange = function () {
        ortImageElem.setAttribute('template', -1);
        setCustomAndRedraw();
    };
    landscapeElem.onchange = setCustomAndRedraw;
    hasTopElem.onchange = setCustomAndRedraw;
    imageWidthElem.onchange = setCustomAndRedraw;
    imageWidthElem.onkeyup = setCustomAndRedraw;
    imageTopElem.onchange = setCustomAndRedraw;
    imageTopElem.onkeyup = setCustomAndRedraw;
    imageLeftElem.onchange = setCustomAndRedraw;
    imageLeftElem.onkeyup = setCustomAndRedraw;
    var setImageQuality = function (quality) {
        return function () {
            window.pxPerCm = quality;
            redraw();
        };
    };
    imageQuality1.onclick = setImageQuality(imageQuality1.value);
    imageQuality2.onclick = setImageQuality(imageQuality2.value);
    redraw();
};
</script>
</head>
<body style='margin:0cm; padding:0cm; font-family:Open Sans;'>
<div style='display:none; position:absolute; top:0px; right:0px; bottom:0px; left:0px; z-index:100; width:auto; height;auto; background-color:rgba(0,0,0,0.25); color:rgb(255,255,255); text-align:center;' id='loading'><br><br><br><br>Lädt...</div>
<div style='position:absolute; top:0px; right:270px; bottom:0px; left:0px; width:auto; height:auto; vertical-align:middle; text-align:center; padding:5px; background-color:rgb(245,245,245); background-image:url(checkerboard.jpg);'>
<div style='position:relative; height:100%; background-size:contain; background-position:center; background-repeat:no-repeat;' id='output'><img id='output-img' style='position:absolute; left:0px; right:0px; top:0px; bottom:0px; width:100%; height:100%; opacity:0.01;' /></div>
</div>
<div style='position:absolute; top:0px; right:0px; bottom:0px; width:250px; height:auto; vertical-align:top; padding:5px; overflow-y:scroll;'>
<a href='' id='download-link' download='panini' style='visibility:hidden;'><h2>Download</h2></a>
<h2>Vorlage<a href='javascript:alert(&quot;Du kannst entweder ein eigenes Panini-Bildli erstellen, oder ein echtes auswählen.&quot;);' style='float:right; font-size:12pt;'>(?)</a></h2>
<div id='template'></div>
<h2>Bild<a href='javascript:alert(&quot;Das Bild, das auf dem Bildli zu sehen ist. Klicken, um ein Bild von deinem Gerät auszuwählen.&quot;);' style='float:right; font-size:12pt;'>(?)</a></h2>
<input type='file' id='image' />
<h2>Text<a href='javascript:alert(&quot;Der Text, der unter dem Bildli angezeigt werden soll.&quot;);' style='float:right; font-size:12pt;'>(?)</a></h2>
<textarea id='text' style='width:100%; height:3em;'></textarea>
<p>
<h2>Ort<a href='javascript:alert(&quot;Das Bild, das als Ortswappen rechts oben angezeigt werden soll.&quot;);' style='float:right; font-size:12pt;'>(?)</a></h2>
<div><select id='ort-select'>
<option value=''>Keiner</option>
<option value='custom'>Eigener...</option>
<option value='adliswil'>Adliswil</option>
<option value='einsiedeln'>Einsiedeln</option>
<option value='hirzel'>Hirzel</option>
<option value='horgen'>Horgen</option>
<option value='huetten'>H&uuml;tten</option>
<option value='kilchberg'>Kilchberg</option>
<option value='langnau_am_albis'>Langnau am Albis</option>
<option value='oberrieden'>Oberrieden</option>
<option value='richterswil'>Richterswil</option>
<option value='rueschlikon'>R&uuml;schlikon</option>
<option value='schoenenberg'>Sch&ouml;nenberg</option>
<option value='thalwil'>Thalwil</option>
<option value='waedenswil'>W&auml;denswil</option>
<option value='zuerich'>Z&uuml;rich</option>
</select></div>
<div><input type='file' id='ort-image' style='display:none;' /></div>
</p>
<h2>Optionen</h2>
<p><input type='checkbox' id='landscape' /> Breitformat</p>
<p><input type='checkbox' id='has-top' /> Banner oben</p>
<p>Grösse <a href='javascript:alert(&quot;Wie gross das Bild sein soll.\nTypischerweise ein Wert zwischen 100% und 400%.\nBei weniger als 100% bleibt links oder rechts ein durchsichtiger Rand.&quot;);'>(?)</a>: <span style='float:right;'><input type='text' id='image-width' value='100' style='width:50px;' /> % </span></p>
<p>Abstand links <a href='javascript:alert(&quot;Wie weit das Bild vom linken Rand entfernt beginnen soll.\nTypischerweise ein Wert zwischen 0% und -200%.\nWenn z.B. Die Grösse 200% ist, muss der Abstand links 100% sein, damit der rechte Teil des Bildes sichtbar ist.&quot;);'>(?)</a>: <span style='float:right;'><input type='text' id='image-left' value='0' style='width:50px;' /> % </span></p>
<p>Abstand oben <a href='javascript:alert(&quot;Wie weit das Bild vom oberen Rand entfernt beginnen soll.\nTypischerweise ein Wert zwischen 0% und -200%.\nWichtig ist, dass ganz unten kein durchsichtiger Rand entsteht.&quot;);'>(?)</a>: <span style='float:right;'><input type='text' id='image-top' value='-10' style='width:50px;' /> % </span></p>
<p>Qualität (in MP): <span style='float:right;'><input type='radio' id='image-quality-1' name='image-quality' value='200' checked='checked' />1 <input type='radio' id='image-quality-2' name='image-quality' value='400' />6</span></p>
</div>
</body>
</html>